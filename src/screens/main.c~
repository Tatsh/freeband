#include "../freeband.h"
#include "../graphics/graphics.h"
#include "instruments.h"
#include "main.h"

bool nonGame;
bool online;
bool options;

char bgTexture[] = "GameData/themes/default/global/bg.png";
char logoTexture[] = "GameData/themes/default/screenStart/banner.png";
char mainSelector[] = "GameData/themes/default/screenStart/selector.png";

/* Note:
   Negative is to the left, positive is to the right when horizontal (x)
   Negative is to the top, positive is to the bottom when vertical (y)
   Negative is to the outside, positive is going inside (z)
   Order of corners: top-left, bottom-left, bottom-right, top-right */
GLfloat logoVertexX[] = { -1.25f, -1.25f, 1.26f, 1.26f }; /* Logo position */
GLfloat logoVertexY[] = {  -1.0f,   0.0f,  0.0f, -1.0f };
GLfloat mSelectorAlpha = 0.3f;
GLfloat mSelectorVertexX[4]; /* Main menu selector's default position */
GLfloat mSelectorVertexY[] = {  0.18f, 0.0f, 0.0f, 0.18f };

GLfloat text_SinglePlayerX[4]; /* SINGLE PLAYER */
GLfloat text_SinglePlayerY[4];
GLfloat text_MultiplayerX[4]; /* MULTIPLAYER */
GLfloat text_OnlineX[4]; /* ONLINE */
GLfloat text_OptionsX[4]; /* OPTIONS */
GLfloat text_QuitX[4]; /* QUIT */

GLfloat text_SinglePlayer_hl[4];
GLfloat text_Multiplayer_hl[4];
GLfloat text_Online_hl[4];
GLfloat text_Options_hl[4];
GLfloat text_Quit_hl[4];

GLuint bg, logo, selectG; /* Textures */
GLuint single, multiplayer, onlineM, optionsM, quit; /* Menu options */
GLuint menuSelection = 0;

tMenuState menuState;

GLvoid handleMainMenu() {
  switch (menuSelection) {

    case 0:
#ifdef __DEBUG__
      fprintf(stdout, "Starting single player mode.\n");
#endif
      nPlayers = 1;
      menuQuit = true; /* We are leaving the menu */
      loading = true; /* We are currently loading textures */
      clearScreen(); /* Clean up screen */
#ifdef __DEBUG__
      fprintf(stdout, "Deleted all screen mainMenu elements.\nLoading single player screenInstruments elements...\n");
#endif
      currentScreen.mainMenu = loading = menuQuit = false;
      nonGame = false; /* We are not going to online mode, options menu, or going to quit */
      currentScreen.instruments = instrument.guitar = true; /* We set guitar to default selection, does not affect highlight */
      break;

    case 1:
#ifdef __DEBUG__
      fprintf(stdout, "Starting multiplayer mode.\n");
#endif
      nonGame = true; /* Until multiplayer is implemented */
      break;

    case 2:
      fprintf(stdout, "Starting online mode.\n");
      nonGame = true;
      online = true;
      break;

    case 3:
      fprintf(stdout, "Going to options menu.\n");
      nonGame = true;
      options = true;
      break;

    case 4:
      quitGame(0);
      break;

    default:
      break;
  }

  return;
}

GLvoid setMainMenuState(GLuint selectID) {
  GLuint i;

  switch(selectID) {
    case 0: /* Single player */
      menuState.quit = false;
      menuState.single = true;
      menuState.multiplayer = false;
      for ( i = 0; i < 4; i++ ) { /* Highlight */
        text_Quit_hl[i] = colour_blue_7CA4F6[i]; /* From down arrow */
        text_Multiplayer_hl[i] = colour_blue_7CA4F6[i]; /* From up arrow */
        text_SinglePlayer_hl[i] = 1.0f;
    }
#ifdef __DEBUG__
    fprintf(stdout, "Selected single player mode.\n");
#endif
    break;

    case 1:  /* Multiplayer */
      menuState.single = false;
      menuState.multiplayer = true;
      menuState.online = false;
      for ( i = 0; i < 4; i++ ) {
        text_SinglePlayer_hl[i] = colour_blue_7CA4F6[i];
        text_Online_hl[i] = colour_blue_7CA4F6[i];
        text_Multiplayer_hl[i] = 1.0f;
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected multiplayer player mode.\n");
#endif
      break;

    case 2: /* Online */
      menuState.multiplayer = false;
      menuState.online = true;
      menuState.options = false;
      for ( i = 0; i < 4; i++ ) {
        text_Multiplayer_hl[i] = colour_blue_7CA4F6[i];
        text_Options_hl[i] = colour_blue_7CA4F6[i];
        text_Online_hl[i] = 1.0f;
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected online mode.\n");
#endif
      break;

    case 3: /* Options */
      menuState.online = false;
      menuState.options = true;
      menuState.quit = false;
      for ( i = 0; i < 4; i++ ) {
        text_Online_hl[i] = colour_blue_7CA4F6[i];
        text_Quit_hl[i] = colour_blue_7CA4F6[i];
        text_Options_hl[i] = 1.0f;
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected options menu.\n");
#endif
      break;

    case 4: /* Quit */
      menuState.options = false;
      menuState.quit = true;
      menuState.single = false;
      for ( i = 0; i < 4; i++ ) {
        text_Options_hl[i] = colour_blue_7CA4F6[i];
        text_SinglePlayer_hl[i] = colour_blue_7CA4F6[i];
        text_Quit_hl[i] = 1.0f;
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected to quit.\n");
#endif
      break;

      default:
        break;
  }

  return;
}

GLvoid setMainImages() {
  GLuint i;

  /* Set 'SINGLE PLAYER' to be highlighted */
  for ( i = 0; i < 4; i++ ) {
    text_SinglePlayer_hl[i] = 1.0f;
    text_Multiplayer_hl[i] = colour_blue_7CA4F6[i];
    text_Online_hl[i] = colour_blue_7CA4F6[i];
    text_Options_hl[i] = colour_blue_7CA4F6[i];
    text_Quit_hl[i] = colour_blue_7CA4F6[i];
  }
  
  if ((bg = loadTexture(bgTexture, 0)) == -1)
    fprintf(stderr, "Unable to load texture: %s.\n", bgTexture);

  if ((logo = loadTexture(logoTexture, 1)) == -1)
    fprintf(stderr, "Unable to load texture: %s.\n", logoTexture);
  
  if ((selectG = loadTexture(mainSelector, 2)) == -1)
    fprintf(stderr, "Unable to load texture: %s.\n", mainSelector);
  for ( i = 0; i < 2; i++ ) mSelectorVertexX[i] = centreAt(0.6f, scaleTextureWidth(400, 52, 0.18f));
  for ( i = 2; i < 4; i++ ) mSelectorVertexX[i] = mSelectorVertexX[i-2] + scaleTextureWidth(400, 52, 0.18f);
  
  return;
}

GLvoid setMainText() {
  GLuint i;
  GLfloat width;
  
  getFont(crilleei);
  single = loadText("SINGLE PLAYER", crillee, white, 0); /* Always load text as white; change using glColor4f */
  width = scaleTextureWidth(545, 96, MENUITEMSHT); /* Get these values from stdout */
  for ( i = 0; i < 2; i++ ) text_SinglePlayerX[i] = centreAt(0.6f, width);
  for ( i = 2; i < 4; i++ ) text_SinglePlayerX[i] = text_SinglePlayerX[i-2] + width;
  
  multiplayer = loadText("MULTIPLAYER", crillee, white, 1);
  for ( i = 0; i < 2; i++ ) text_MultiplayerX[i] = centreAt(0.6f, scaleTextureWidth(489, 96, MENUITEMSHT));
  for ( i = 2; i < 4; i++ ) text_MultiplayerX[i] = text_MultiplayerX[i-2] + scaleTextureWidth(489, 96, MENUITEMSHT);
  
  onlineM = loadText("ONLINE", crillee, white, 2);
  for ( i = 0; i < 2; i++ ) text_OnlineX[i] = centreAt(0.6f, scaleTextureWidth(266, 96, MENUITEMSHT));
  for ( i = 2; i < 4; i++ ) text_OnlineX[i] = text_OnlineX[i-2] + scaleTextureWidth(266, 96, MENUITEMSHT);
  
  optionsM = loadText("OPTIONS", crillee, white, 3);
  for ( i = 0; i < 2; i++ ) text_OptionsX[i] = centreAt(0.6f, scaleTextureWidth(311, 96, MENUITEMSHT));
  for ( i = 2; i < 4; i++ ) text_OptionsX[i] = text_OptionsX[i-2] + scaleTextureWidth(311, 96, MENUITEMSHT);
  
  quit = loadText("QUIT", crillee, white, 4);
  for ( i = 0; i < 2; i++ ) text_QuitX[i] = centreAt(0.6f, scaleTextureWidth(168, 96, MENUITEMSHT));
  for ( i = 2; i < 4; i++ ) text_QuitX[i] = text_QuitX[i-2] + scaleTextureWidth(168, 96, MENUITEMSHT);
  
  if (crillee)
    TTF_CloseFont(crillee);

  return;
}

GLvoid screenMain() {  
  glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
  glBindTexture( GL_TEXTURE_2D, bg );
  positionTexture(fillBGVertexX, fillBGVertexY, defVertexZ);

  glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
  glBindTexture( GL_TEXTURE_2D, logo );
  positionTexture(logoVertexX, logoVertexY, defVertexZ);

  glColor4f(1.0, 1.0f, 1.0f, mSelectorAlpha);
  glBindTexture( GL_TEXTURE_2D, selectG ); /* Use selector's default position */
  positionTexture(mSelectorVertexX, mSelectorVertexY, defVertexZ);
  
  /* Text positions */
  glPushMatrix(); {
    glTranslatef(0.0f, -0.017f, 0.0f);
  
    glColor4f(text_SinglePlayer_hl[0], text_SinglePlayer_hl[1], text_SinglePlayer_hl[2], text_SinglePlayer_hl[3]);
    glBindTexture( GL_TEXTURE_2D, single );
    positionTexture(text_SinglePlayerX, text_SinglePlayerY, defVertexZ);
    
    glColor4f(text_Multiplayer_hl[0], text_Multiplayer_hl[1], text_Multiplayer_hl[2], text_Multiplayer_hl[3]);
    glBindTexture( GL_TEXTURE_2D, multiplayer );
    positionTexture(text_MultiplayerX, text_MultiplayerY, defVertexZ);

    glColor4f(text_Online_hl[0], text_Online_hl[1], text_Online_hl[2], text_Online_hl[3]); 
    glBindTexture( GL_TEXTURE_2D, onlineM );
    positionTexture(text_OnlineX, text_OnlineY, defVertexZ);

    glColor4f(text_Options_hl[0], text_Options_hl[1], text_Options_hl[2], text_Options_hl[3]);
    glBindTexture( GL_TEXTURE_2D, optionsM );
    positionTexture(text_OptionsX, text_OptionsY, defVertexZ);
  
    glColor4f(text_Quit_hl[0], text_Quit_hl[1], text_Quit_hl[2], text_Quit_hl[3]);
    glBindTexture( GL_TEXTURE_2D, quit );
    positionTexture(text_QuitX, text_QuitY, defVertexZ);
  }
  glPopMatrix();

  return;
}
