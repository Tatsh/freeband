#include "../freeband.h"
#include "../graphics/graphics.h"
#include "instruments.h"
#include "main.h"
#include "songs.h"

char instCanvas[] = "GameData/themes/default/screenInstruments/canvas.png";
char selectedGradient[] = "GameData/themes/default/screenInstruments/selectedgrad.png";

/* Negative is to the left, positive is to the right when horizontal (x)
   Negative is to the top, positive is to the bottom when vertical (y)
   Negative is to the outside, positive is going inside (z)
   Order of corners: top-left, bottom-left, bottom-right, top-right */
GLfloat instCanvasX[] = { 0.1f, 0.1f, 1.2f, 1.2f };
GLfloat instCanvasY[] = { -0.4f, 0.6f, 0.6f, -0.4 };
GLfloat selectedGradientX[] = { 0.12f, 0.12f, 1.18f, 1.18f }; /* This places it underneath 'GUITAR' */
GLfloat selectedGradientY[] = { -0.35f, -0.15f, -0.15f, -0.35f };
GLfloat selectedGradientY_reset[] = { -0.35f, -0.15f, -0.15f, -0.35f };

GLfloat text_GuitarX[4];
GLfloat text_GuitarY[] = { 0.0f, MENUITEMSHT, MENUITEMSHT, 0.0f };
GLfloat text_BassX[4];
GLfloat text_BassY[4];
GLfloat text_DrumsX[4];
GLfloat text_DrumsY[4];
GLfloat text_VocalsX[4];
GLfloat text_VocalsY[4];

GLfloat text_Guitar_hl[4];
GLfloat text_Bass_hl[4];
GLfloat text_Drums_hl[4];
GLfloat text_Vocals_hl[4];

GLfloat text_SelectInstrumentX[4]; /* Crillee is italic on its own, this makes it appear not italic */
GLfloat text_SelectInstrumentY[] = { 0.0f, SCREENHEADTEXTHT, SCREENHEADTEXTHT, 0.0f };

GLfloat degree = 0.0f;

GLuint instSelection = 0; /* Guitar */

tInstrument instrument;

GLvoid handleInstrumentsMenu() {
  switch(instSelection) {
    case 0:
#ifdef __DEBUG__
      fprintf(stdout, "Starting %d player guitar game.\n", nPlayers);
#endif
      break;
      
    case 1:
#ifdef __DEBUG__
      fprintf(stdout, "Starting %d player bass game.\n", nPlayers);
#endif      
      break;
      
    case 2:
#ifdef __DEBUG__
      fprintf(stdout, "Starting %d player drums game.\n", nPlayers);
#endif
      break;
      
    case 3:
#ifdef __DEBUG__
      fprintf(stdout, "Starting %d player vocals game.\n", nPlayers);
#endif
      break;
      
    default:
      break;
  }

  menuQuit = true;
  loading = true;
  clearScreen();
#ifdef __DEBUG__
  fprintf(stdout, "Deleted all screenInstruments elements.\nLoading screenSongs elements...\n");
#endif
  currentScreen.instruments = loading = menuQuit = false;
  currentScreen.songs = true;

  return;
}

GLvoid setInstrument(GLuint instSelection) {
  GLuint i;
  
  switch(instSelection) {
    case 0:  /* Guitar */
      instrument.guitar = true;
      instrument.bass = false;
      instrument.drums = false;
      instrument.vocals = false;
      for ( i = 0; i < 4; i++ ) { /* Highlight */
        text_Vocals_hl[i] = 1.0f; /* From down arrow */
        text_Bass_hl[i] = 1.0f; /* From up arrow */
        text_Guitar_hl[i] = colour_yellow_F0FF07[i];
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected Guitar gameplay.\n");
#endif
      break;

    case 1: /* Bass */
      instrument.guitar = false;
      instrument.bass = true;
      instrument.drums = false;
      instrument.vocals = false;
      for ( i = 0; i < 4; i++ ) {
        text_Guitar_hl[i] = 1.0f;
        text_Drums_hl[i] = 1.0f;
        text_Bass_hl[i] = colour_yellow_F0FF07[i];
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected Bass gameplay.\n");
#endif
      break;

    case 2: /* Drums */
      instrument.guitar = false;
      instrument.bass = false;
      instrument.drums = true;
      instrument.vocals = false;
      for ( i = 0; i < 4; i++ ) {
        text_Bass_hl[i] = 1.0f;
        text_Vocals_hl[i] = 1.0f;
        text_Drums_hl[i] = colour_yellow_F0FF07[i];
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected Drums gameplay.\n");
#endif
      break;

    case 3: /* Vocals */
      instrument.guitar = false;
      instrument.bass = false;
      instrument.drums = false;
      instrument.vocals = true;
      for ( i = 0; i < 4; i++ ) {
        text_Drums_hl[i] = 1.0f;
        text_Guitar_hl[i] = 1.0f;
        text_Vocals_hl[i] = colour_yellow_F0FF07[i];
      }
#ifdef __DEBUG__
      fprintf(stdout, "Selected Vocals gameplay.\n");
#endif
      break;
    
      default:
        break;

  }

  return;
}

GLvoid setInstrumentsImages_1P() {
  if ((bg = loadTexture(bgTexture, 0)) == -1)
    fprintf(stderr, "Unable to load texture: %s.\n", bgTexture);
  
  if ((texture[1] = loadTexture(instCanvas, 1)) == -1)
    fprintf(stderr, "Unable to load texture: %s.\n", instCanvas);
  
  if ((texture[2] = loadTexture(selectedGradient, 2)) == -1)
    fprintf(stderr, "Unable to load texture: %s.\n", selectedGradient);
  
  return;
}

GLvoid setInstrumentsText_1P() {
  GLfloat width;
  GLuint i;
  GLuint text_guitar, text_bass, text_drums, text_vocals;
  GLuint text_selectInstrument;

  getFont(bitstreami); {
    text_guitar = loadText("GUITAR", bitstream, white, 0);
    width = scaleTextureWidth(298, 84, MENUITEMSHT);
    for ( i = 0; i < 2; i++ ) text_GuitarX[i] = centreAt(0.6f, width);
    for ( i = 2; i < 4; i++ ) text_GuitarX[i] = text_GuitarX[i-2] + width;

    text_bass = loadText("BASS", bitstream, white, 1);
    width = scaleTextureWidth(212, 84, MENUITEMSHT);
    for ( i = 0; i < 2; i++ ) text_BassX[i] = centreAt(0.6f, width);
    for ( i = 2; i < 4; i++ ) text_BassX[i] = text_BassX[i-2] + width;

    text_drums = loadText("DRUMS", bitstream, white, 2);
    width = scaleTextureWidth(297, 84, MENUITEMSHT);
    for ( i = 0; i < 2; i++ ) text_DrumsX[i] = centreAt(0.6f, width);
    for ( i = 2; i < 4; i++ ) text_DrumsX[i] = text_DrumsX[i-2] + width;

    text_vocals = loadText("VOCALS", bitstream, white, 3);
    width = scaleTextureWidth(323, 84, MENUITEMSHT);
    for ( i = 0; i < 2; i++ ) text_VocalsX[i] = centreAt(0.6f, width);
    for ( i = 2; i < 4; i++ ) text_VocalsX[i] = text_VocalsX[i-2] + width;
  } if (bitstream) TTF_CloseFont(bitstream);

  getFont(crilleei); {
    text_selectInstrument = loadText("SELECT INSTRUMENT", crillee, white, 4);
    width = scaleTextureWidth(747, 96, SCREENHEADTEXTHT);
    for ( i = 0; i < 2; i++ ) text_SelectInstrumentX[i] = centreAt(0.0f, width);
    for ( i = 2; i < 4; i++ ) text_SelectInstrumentX[i] = text_SelectInstrumentX[i-2] + width;
  } if (crillee) TTF_CloseFont(crillee); /* Clean up */

  return;
}

GLvoid screenInstrumentsBuffer(GLuint nPlayers) {
  GLuint i;
  
  if (nPlayers < 2) {
    
    /* Generate Y coordinates for text */
    for ( i = 0; i < 4; i++ ) text_BassY[i] = text_GuitarY[i] + 0.2;
    for ( i = 0; i < 4; i++ ) text_DrumsY[i] = text_BassY[i] + 0.2;
    for ( i = 0; i < 4; i++ ) text_VocalsY[i] = text_DrumsY[i] + 0.2;
  
    /* Set guitar to be highlighted by default */
    for ( i = 0; i < 4; i++ ) {
      text_Guitar_hl[i] = colour_yellow_F0FF07[i];
      text_Bass_hl[i] = 1.0f;
      text_Drums_hl[i] = 1.0f;
      text_Vocals_hl[i] = 1.0f;
    }

    setInstrumentsImages_1P();
    setInstrumentsText_1P();
 
  }
  else
    fprintf(stdout, "Multiplayer not implemented yet.\n");
#ifdef __DEBUG__
  fprintf(stdout, "Loading textures of screenInstruments complete.\n");
#endif
  
  return;
}

GLvoid screenInstruments(GLuint nPlayers) {
  glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
  glBindTexture( GL_TEXTURE_2D, bg );
  positionTexture(fillBGVertexX, fillBGVertexY, defVertexZ);

/*  glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
  glBindTexture( GL_TEXTURE_2D, texture[1] );
  positionTexture(instCanvasX, instCanvasY, defVertexZ);*/
  
/*  glColor4f(1.0f, 1.0f, 1.0f, 0.3f);
  glBindTexture( GL_TEXTURE_2D, texture[2] );
  positionTexture(selectedGradientX, selectedGradientY, defVertexZ);*/

  /* Text elements */
  glPushMatrix(); {
    glTranslatef(0.0f, -0.35f, 0.0f);
    glColor4f(text_Guitar_hl[0], text_Guitar_hl[1], text_Guitar_hl[2], text_Guitar_hl[3]);
    glBindTexture( GL_TEXTURE_2D, text[0] );
    positionTexture(text_GuitarX, text_GuitarY, defVertexZ);

    glColor4f(text_Bass_hl[0], text_Bass_hl[1], text_Bass_hl[2], text_Bass_hl[3]);
    glBindTexture( GL_TEXTURE_2D, text[1] );
    positionTexture(text_BassX, text_BassY, defVertexZ);

    glColor4f(text_Drums_hl[0], text_Drums_hl[1], text_Drums_hl[2], text_Drums_hl[3]);
    glBindTexture( GL_TEXTURE_2D, text[2] );
    positionTexture(text_DrumsX, text_DrumsY, defVertexZ);

    glColor4f(text_Vocals_hl[0], text_Vocals_hl[1], text_Vocals_hl[2], text_Vocals_hl[3]);
    glBindTexture( GL_TEXTURE_2D, text[3] );
    positionTexture(text_VocalsX, text_VocalsY, defVertexZ);
  } glPopMatrix();

  glPushMatrix(); {
    glColor4f(1.0f, 1.0f, 1.0f, 1.0f);
    glTranslatef(0.0f, -1.05f, 0.0f);
    glBindTexture( GL_TEXTURE_2D, text[4] ); /* Top screen title */
    positionTexture(text_SelectInstrumentX, text_SelectInstrumentY, defVertexZ);
  } glPopMatrix();


  switch (instSelection) {
    case 0:
      glTranslatef(-0.15f, -0.05f, 2.0f);
      glRotatef( 110.0f, -0.05f, 0.0f, 0.0f );
      glRotatef( degree, 0.0f, 0.0f, 0.05f );
      glPushMatrix();
      glBindTexture( GL_TEXTURE_2D, texture[0] );
      glColor4f(-1.0f, 1.0f, 1.0f, 1.0f);
      gluCylinder( quadratic, 0.05f, 0.05f, 0.1f, 32, 32 );
      glPopMatrix();
      break;
      
    case 1:
      glTranslatef(-0.15f, -0.05f, 2.0f);
      glRotatef( 110.0f, -0.05f, 0.0f, 0.0f );
      glRotatef( degree, 0.0f, 0.0f, 0.05f );
      glPushMatrix();
      glBindTexture( GL_TEXTURE_2D, texture[0] );
      glColor4f(1.0f, -1.0f, 1.0f, 1.0f);
      gluCylinder( quadratic, 0.05f, 0.0f, 0.1f, 32, 32 );
      glPopMatrix();
      break;
      
    case 2:
      glTranslatef(-0.15f, 0.0f, 2.0f);
      glRotatef( 180.0f, 0.05f, 0.0f, 0.0f );
      glRotatef( degree, 0.0f, -0.05f, 0.0f );
      glPushMatrix();
      glBindTexture( GL_TEXTURE_2D, texture[0] );
      glColor4f(1.0f, 1.0f, -1.0f, 1.0f);
      glutSolidTeapot(0.05f);
      glPopMatrix();
      break;
      
    case 3:
      glTranslatef(-0.15f, 0.0f, 2.0f);
      glRotatef( 180.0f, 0.05f, 0.0f, 0.0f );
      glRotatef( degree, 0.0f, -0.05f, 0.0f );
      glPushMatrix();
      glBindTexture( GL_TEXTURE_2D, texture[0] );
      glColor4f(-1.0f, 1.0f, -1.0f, 1.0f);
      glutWireTeapot(0.05f);
      glPopMatrix();
      break;
      
    default:
      break;
  }

  if (degree == 360.0f)
    degree = 0.0f;
  else
    degree += 0.5f;
}
